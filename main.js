(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"91f56e1f-97d3-4b89-bc18-e399f58689ca","Content-Type":"application/json"}};function t(e){u(e.target)}function n(){document.querySelector(".popup_is-opened").addEventListener("click",t)}function o(){document.querySelector(".popup_is-opened").removeEventListener("click",t)}function c(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function r(e){var r=e.querySelector(".popup__content");e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),e.addEventListener("click",t),r.addEventListener("mouseleave",n),r.addEventListener("mouseenter",o)}function u(e){var r=e.querySelector(".popup__content");e.classList.remove("popup_is-opened"),e.removeEventListener("click",t),r.removeEventListener("mouseleave",n),r.removeEventListener("mouseenter",o),document.removeEventListener("keydown",c)}var a=document.querySelector("#card-template").content;function i(t,n){var o=a.querySelector(".places__item").cloneNode(!0),c=o.querySelector(".card__image"),u=o.querySelector(".card__title"),i=o.querySelector(".card__delete-button"),s=o.querySelector(".card__like-button"),l=o.querySelector(".card__like-amount"),p=document.querySelector(".popup__caption"),d=document.querySelector(".popup_type_image");return u.textContent=t.name,l.textContent=t.likes.length,o.setAttribute("id",t._id),c.setAttribute("src",t.link),c.setAttribute("alt",t.name.toLowerCase()),t.owner._id!==n&&i.remove(),c.addEventListener("click",(function(){c.alt=t.name,c.src=t.link,p.textContent=t.name,r(d)})),s.addEventListener("click",(function(n){var o;n.target.classList.contains("card__like-button_is-active")?(o=t._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){l.textContent=e.likes.length,n.target.classList.remove("card__like-button_is-active")})).catch((function(e){return console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(t._id).then((function(e){l.textContent=e.likes.length,n.target.classList.add("card__like-button_is-active")})).catch((function(e){return console.log(e)}))})),i.addEventListener("click",(function(n){var o;(o=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(){n.target.closest(".places__item").remove()})).catch((function(e){return console.log(e)}))})),o}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n):t.classList.add(n)}var l=document.querySelector(".popup_type_image"),p=l.querySelector(".popup__image"),d=document.querySelector(".popup__caption");l.querySelector(".popup__close").addEventListener("click",(function(){u(l)}));var _=document.querySelector(".popup_type_edit"),f=_.querySelector(".popup__form"),m=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),h=document.querySelector(".popup__input_type_name"),S=document.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__edit-button"),g=_.querySelector(".popup__close"),L=_.querySelector(".popup__button");f.addEventListener("submit",(function(t){t.preventDefault();var n,o,c=h.value,r=S.value;L.textContent="Сохранение...",(n=c,o=r,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){m.textContent=e.name,v.textContent=e.about})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){u(_),L.textContent="Сохранить"})),u(_)})),q.addEventListener("click",(function(){h.value=m.textContent,S.value=v.textContent,r(_)})),g.addEventListener("click",(function(){u(_)}));var b=document.querySelector(".popup_type_new-card"),k=b.querySelector(".popup__form"),E=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url"),x=document.querySelector(".places__list"),j=document.querySelector(".profile__add-button"),P=b.querySelector(".popup__close"),A=b.querySelector(".popup__button");j.addEventListener("click",(function(){E.value="",C.value="",r(b)})),P.addEventListener("click",(function(){u(b)})),k.addEventListener("submit",(function(t){t.preventDefault();var n=E.value,o=C.value;A.textContent="Сохранение...",function(t,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n,o).then((function(e){x.prepend(i(e,U))})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){u(b),A.textContent="Сохранить"})),u(b)})),x.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&(p.setAttribute("src",""),p.setAttribute("src",e.target.src),d.textContent=e.target.alt,r(l))}));var U,T,w=document.querySelector(".popup_type_avatar"),B=w.querySelector(".popup__form"),D=w.querySelector(".popup__input_type_avatar"),N=w.querySelector(".popup__button"),O=w.querySelector(".popup__close");B.addEventListener("submit",(function(t){t.preventDefault();var n=D.value;N.textContent="Сохранение...",function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n).then((function(e){y.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){u(w),N.textContent="Сохранить"})),u(w)})),y.addEventListener("click",(function(){r(w)})),O.addEventListener("click",(function(){u(w)})),fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e)})).catch((function(e){console.log(e)})).then((function(e){m.textContent=e.name,v.textContent=e.about,y.style.backgroundImage="url(".concat(e.avatar,")"),U=e._id})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).then((function(e){e.forEach((function(e){return x.append(i(e,U))}))})).catch((function(e){console.log(e)})),_.classList.add("popup_is-animated"),b.classList.add("popup_is-animated"),l.classList.add("popup_is-animated"),T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_type_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(T.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);s(n,o,t.inactiveButtonClass),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n,o){console.log("1"),t.validity.valid?function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));c.textContent="",t.classList.remove(n),c.classList.remove(o)}(e,t,n,o):function(e,t,n,o,c){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,t.classList.add(o),r.classList.add(c)}(e,t,t.validationMessage,n,o)}(e,c,t.inputErrorClass,t.errorClass),s(n,o,t.inactiveButtonClass)}))}))}(e,T)}))})();